<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>食事記録</title>
<style>
  :root { --primary-color: #007AFF; --bg-color: #F2F2F7; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    background-color: var(--bg-color);
    margin: 0; padding: 20px; color: #333;
    padding-bottom: 100px; /* ボタンが隠れないように余白 */
  }
  h2 { text-align: center; font-size: 1.2rem; margin-bottom: 20px; color: #333; }
  
  /* リスト全体のスタイル */
  .list-container {
    background: white; border-radius: 12px; overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px;
  }
  
  /* 各行のスタイル */
  .item-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 16px; border-bottom: 1px solid #E5E5EA;
  }
  .item-row:last-child { border-bottom: none; }
  
  /* アイテム名 */
  .item-name { flex: 1; font-weight: 600; font-size: 1rem; }
  
  /* ラジオボタンのエリア */
  .options { display: flex; gap: 8px; }
  
  /* カスタムラジオボタンのデザイン（押しやすくする） */
  .radio-label {
    padding: 6px 10px; border-radius: 8px; border: 1px solid #D1D1D6;
    font-size: 0.85rem; cursor: pointer; background: #fff;
    transition: all 0.2s;
  }
  /* 選択された時の色 */
  input[type="radio"] { display: none; } /* 本来のボタンは消す */
  
  /* 完食が選ばれた時 */
  input[value="finish"]:checked + .radio-label {
    background-color: #34C759; color: white; border-color: #34C759;
  }
  /* 残しが選ばれた時 */
  input[value="left"]:checked + .radio-label {
    background-color: #FF3B30; color: white; border-color: #FF3B30;
  }
  
  /* 自由入力エリア */
  .custom-input {
    width: 60%; padding: 8px; border: 1px solid #D1D1D6;
    border-radius: 6px; font-size: 1rem;
  }

  /* 下部固定ボタンエリア */
  .fixed-footer {
    position: fixed; bottom: 0; left: 0; width: 100%;
    background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
    padding: 15px 20px; box-sizing: border-box;
    border-top: 1px solid #ccc; display: flex; gap: 10px;
  }
  
  .btn {
    border: none; padding: 14px; border-radius: 12px;
    font-size: 1rem; font-weight: bold; cursor: pointer; flex: 1;
  }
  .btn-add { background-color: #E5E5EA; color: #007AFF; }
  .btn-copy { background-color: var(--primary-color); color: white; flex: 2; }
  .btn:active { opacity: 0.7; }

</style>
</head>
<body>

<h2>本日の食事チェック</h2>

<div id="main-list" class="list-container">
  </div>

<div id="custom-list" class="list-container" style="display:none;"></div>

<div class="fixed-footer">
  <button class="btn btn-add" onclick="addCustomItem()">＋ 追加</button>
  <button class="btn btn-copy" onclick="generateAndCopy()">コピーする</button>
</div>

<script>
  // ★ここに固定メニューを設定してください
  const defaultItems = ["パン", "ご飯", "コロッケ", "バナナ", "牛乳", "みそ汁"];

  // 初期ロード時
  window.onload = function() {
    const container = document.getElementById('main-list');
    defaultItems.forEach((item, idx) => {
      createRow(container, item, idx, false);
    });
  };

  let customCount = 0;

  // 行を作成する関数
  function createRow(container, name, index, isCustom) {
    const div = document.createElement('div');
    div.className = 'item-row';
    const groupName = isCustom ? `custom_${index}` : `default_${index}`;
    
    // 表示部分（固定ならテキスト、カスタムなら入力欄）
    let nameHtml = `<div class="item-name">${name}</div>`;
    if(isCustom) {
      nameHtml = `<input type="text" class="custom-input item-name-input" placeholder="品名を入力">`;
      document.getElementById('custom-list').style.display = 'block';
    }

    div.innerHTML = `
      ${nameHtml}
      <div class="options">
        <label>
          <input type="radio" name="${groupName}" value="finish">
          <span class="radio-label">完食</span>
        </label>
        <label>
          <input type="radio" name="${groupName}" value="left">
          <span class="radio-label">残し</span>
        </label>
        <label>
          <input type="radio" name="${groupName}" value="none" checked>
          <span class="radio-label" style="background:#eee; color:#999; border:none;">―</span>
        </label>
      </div>
    `;
    container.appendChild(div);
  }

  // 「その他を追加」ボタン
  function addCustomItem() {
    customCount++;
    createRow(document.getElementById('custom-list'), "", customCount, true);
  }

  // 集計とコピー処理
  function generateAndCopy() {
    let finished = [];
    let leftovers = [];

    // 固定アイテムの集計
    defaultItems.forEach((item, idx) => {
      const val = getRadioValue(`default_${idx}`);
      if(val === 'finish') finished.push(item);
      if(val === 'left') leftovers.push(item);
    });

    // カスタムアイテムの集計
    const customContainer = document.getElementById('custom-list');
    const customRows = customContainer.getElementsByClassName('item-row');
    
    for(let i=0; i<customRows.length; i++) {
      const input = customRows[i].querySelector('.item-name-input');
      const itemName = input.value.trim();
      if(itemName) { // 名前が入力されている場合のみ
        // customCountは通し番号なので、name属性から正しいgroupNameを取得
        const radioName = customRows[i].querySelector('input[type="radio"]').name;
        const val = getRadioValue(radioName);
        
        if(val === 'finish') finished.push(itemName);
        if(val === 'left') leftovers.push(itemName);
      }
    }

    // テキスト生成
    let resultText = "";
    if(finished.length > 0) resultText += `（完食）${finished.join("、")}\n`;
    if(leftovers.length > 0) resultText += `（残し）${leftovers.join("、")}`;

    if(!resultText) {
      alert("「完食」または「残し」が選択されていません");
      return;
    }

    // クリップボードへコピー
    if (navigator.clipboard) {
        navigator.clipboard.writeText(resultText).then(() => {
            alert("コピーしました！\n貼り付けてください。\n\n" + resultText);
        }).catch(err => {
            alert("コピーに失敗しました。");
        });
    } else {
        // 古いiOS等のフォールバック
        const textarea = document.createElement('textarea');
        textarea.value = resultText;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert("コピーしました！\n\n" + resultText);
    }
  }

  function getRadioValue(name) {
    const radios = document.getElementsByName(name);
    for(const r of radios) {
      if(r.checked) return r.value;
    }
    return 'none';
  }
</script>
</body>
</html>
